<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Product List</title>
</head>
<body>
<div layout:fragment="content">
    <div class="main-wrapper">
        <div class="row mb-3">
            <div class="col-lg-6 table-title">
                <a href="#addEditModal" class="btn btn-success" data-bs-toggle="modal"><i class="material-icons">&#xE147;</i>
                    <span>Add New</span></a>
            </div>
            <div class="col-lg-6 table-search">
                <form class="row gy-2 gx-3 align-items-center">
                    <div class="col-auto">
                        <select class="form-select" name="searchBy">
                            <option selected value="">Search by...</option>
                            <option value="name">Name</option>
                            <option value="price">From Price</option>
                            <option value="manufacturer">Manufacturer</option>
                            <option value="exp_date">From EXPDate</option>
                            <option value="category">Category</option>
                        </select>
                    </div>
                    <div class="col-auto">
                        <input type="text" class="form-control" name="searchVal"
                               placeholder="Default by all">
                    </div>

                    <div class="col-auto">
                        <button class="btn btn-secondary">Submit</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="row">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col"><a th:href="'?page=' + ${res.getNumber() + 1} + '&sort=name,'+ ${reverseSortDir}">Name<i class="fas fa-sort"></i></a></th>
                    <th scope="col"><a th:href="'?page=' + ${res.getNumber() + 1} + '&sort=price,'+ ${reverseSortDir}">Price<i class="fas fa-sort"></i></a></th>
                    <th scope="col"><a th:href="'?page=' + ${res.getNumber() + 1} + '&sort=expDate,'+ ${reverseSortDir}">EXP Date<i class="fas fa-sort"></i></a></th>
                    <th scope="col"><a th:href="'?page=' + ${res.getNumber() + 1} + '&sort=manufacturer,'+ ${reverseSortDir}">Manufacturer<i class="fas fa-sort"></i></a></th>
                    <th scope="col"><a th:href="'?page=' + ${res.getNumber() + 1} + '&sort=category,'+ ${reverseSortDir}">Category<i class="fas fa-sort"></i></a></th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="p, i: ${res}">
                    <td th:text="${i.count + res.getNumber() * res.getSize()}"></td>
                    <td th:text="${p.name}"></td>
                    <td th:text="${p.price}"></td>
                    <td th:text="${p.expDate}"></td>
                    <td th:text="${p.manufacturer}"></td>
                    <td th:text="${p.category.name}"></td>
                    <td>
                        <a href="#addEditModal" class="edit" data-bs-toggle="modal"><i class="material-icons"
                                                                                       data-toggle="tooltip"
                                                                                       title="Edit">&#xE254;</i></a>
                        <a href="#deleteModal" class="delete" data-bs-toggle="modal"><i class="material-icons"
                                                                                        data-toggle="tooltip"
                                                                                        title="Delete">&#xE872;</i></a>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="d-flex justify-content-between">
                <div class="pt-2">Showing [[${res.getNumberOfElements()}]] out of [[${res.getTotalElements()}]]</div>
                <div>
                    <nav>
                        <ul class="pagination">
                            <li class="page-item" th:classappend="${!res.hasPrevious()} ? 'disabled'">
                                <a class="page-link" href="#">Previous</a>
                            </li>
                            <li class="page-item" th:each="i : ${#numbers.sequence(1, res.getTotalPages())}"
                                th:classappend="${i == res.getNumber() + 1} ? 'active' : ''">
                                <a class="page-link" th:href="'?page=' + ${i}">[[${i}]]</a>
                            </li>
                            <li class="page-item" th:classappend="${!res.hasNext()} ? 'disabled'">
                                <a class="page-link" href="#">Next</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

        </div>

        <div class="page-footer">
            <a href="#" class="page-footer-item page-footer-item-right">Category<i data-feather="arrow-right"
                                                                                   class="footer-right"></i></a>
        </div>

        <div class="modal fade" id="addEditModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <form method="post" th:object="${product}">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Edit Item</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="mb-3">
                                <label class="form-label">Name</label>
                                <input class="form-control" name="name"/>
                                <label style="color: #fc9494" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></label>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Price</label>
                                <input type="number" class="form-control" name="price">
                                <label style="color: #fc9494" th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></label>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">EXP Date</label>
                                <input type="text" class="date form-control" name="expDate"/>
                                <label style="color: #fc9494" th:if="${#fields.hasErrors('expDate')}" th:errors="*{expDate}"></label>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Manufacturer</label>
                                <input class="form-control" name="manufacturer"/>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Category</label>
                                <select name="category" class="form-select">
                                    <option th:each="item:${cate}" th:value="${item.id}" th:text="${item.name}"></option>
                                </select>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-success">Save</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Delete Item</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to delete this record?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-danger">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script th:inline="javascript">
    $( document ).ready(function() {
        if([[${isError}]]) {
            $("input[name='name']").val([[${product.name}]]);
            $("input[name='price']").val([[${product.price}]]);
            $("input[name='expDate']").val([[${product.expDate}]]);
            $("input[name='manufacturer']").val([[${product.manufacturer}]]);
            $("#addEditModal").modal('show');
        }

        if([[${b}]]){
            iziToast.success({  position: "topRight",message: "aaaaa"});
        }
    })
</script>
